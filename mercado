#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <locale.h>

struct Produto{
	int cod;
	char nome[30];
	float preco;
	int qntEstq = 0;
};

struct Carrinho{
	Produto produto; 
	int qntCarrinho;
};

void cadastrarProduto(struct Produto produto[], int *qnt){
	int i;
	int cad = 0;
	
	printf("Deseja cadastrar quantos produtos: ");
	scanf(" %d", &cad);
	
	system("cls");
	
	for(i = *qnt; i < (cad + *qnt); i++){
		
		printf("-------------Cadastro de Produto-------------\n\n");
		
		printf("Digite o nome do produto %d: ", i+1);
		scanf(" %50[^\n]", &produto[i].nome);
		
		printf("Digite o preço do produto %d: ", i+1);
		scanf(" %f", &produto[i].preco);
		
		printf("Digite a quantidade do produto %d em estoque: ", i+1);
		scanf(" %d", &produto[i].qntEstq);
		
		produto[i].cod = i + 1;
		
		system("pause");
		system("cls");		
	}
	*qnt += cad;
	
}

void listarProdutos(struct Produto produto[], int qnt){
	int i;
	
	printf("-------------Produtos Listados-------------\n\n");
	if(qnt != 0){
		for(i = 0; i < qnt; i++){					
			printf("Código: %d\n", produto[i].cod);
			printf("Nome: %s\n", produto[i].nome);
			printf("Preço: %.2f\n", produto[i].preco);
			printf("Quantidade em Estoque: %d\n", produto[i].qntEstq);
			printf("--------------------\n\n");
		}
	}else{
		printf("Nenhum produto foi cadastrado!");
	}
	system("pause");
	system("cls");
}

void comprarProduto(struct Produto produto[], struct Carrinho carrinho[], int qntProd, int *qntProdCarrinho, int qnt){
	int i;
	int j;
	int codProd = 0;
	int qntDesejada = 0;
	int prodEncontrado = 0;
	
	printf("Deseja comprar quantos produtos? ");
	scanf(" %d", &qntProd);
	system("cls");
	
	if(qnt != 0){
		for(i = 0; i < qnt; i++){					
			printf("Código: %d\n", produto[i].cod);
			printf("Nome: %s\n", produto[i].nome);
			printf("Preço: %.2f\n", produto[i].preco);
			printf("Quantidade em Estoque: %d\n", produto[i].qntEstq);
			printf("--------------------\n\n");
		}
	}else{
		printf("Nenhum produto foi cadastrado!");
	}
	
	for(i = 0; i < qntProd; i++){
		printf("Digite a o codigo do produto: ");
		scanf(" %d", &codProd);
		
		
		for(j = 0; j < qntProd; j++){
			if(produto[j].cod == codProd){
				prodEncontrado = 1;
				printf("Produto: %s\n", produto[j].nome);
                printf("Quantidade em estoque: %d\n", produto[j].qntEstq);
                printf("Digite a quantidade desejada: ");
                scanf("%d", &qntDesejada);
                system("cls");
                
                if(qntDesejada <= produto[j].qntEstq){
                	
                	produto[j].qntEstq -= qntDesejada;	
                	
                	carrinho[*qntProdCarrinho].produto = produto[j];  
                    carrinho[*qntProdCarrinho].qntCarrinho = qntDesejada;  
                    
                    (*qntProdCarrinho)++;
                	
                	printf("Produto adicionado ao carrinho!\n");   	
                	system("pause");
                	system("cls");   	
                	
				}else if(qntDesejada > produto[j].qntEstq){
					printf("Quantidade indisponível em estoque!\n");
					system("pause");
                	system("cls");
				}
			}
		}if(!prodEncontrado){
				printf("Produto não encontrado!\n");
				system("pause");
                system("cls");
				}
		
	}	
}

void vizualizarCarrinho(struct Produto produto[], struct Carrinho carrinho[], int qntProdCarrinho){
	int i = 0;
	float soma = 0;
	
	if(qntProdCarrinho < 0){
		for(i = 0; i < qntProdCarrinho; i++){
			soma = (carrinho[i].produto.preco * carrinho[i].qntCarrinho);
			printf ("Produto: %s\n", carrinho[i].produto.nome);
			printf ("Unidades: %d\n", carrinho[i].qntCarrinho);
			printf ("Valor Unitário: %.2f\n", carrinho[i].produto.preco);
			printf("Valor Total do Produto: %.2f\n", soma);
			printf("--------------------\n\n");
		}
		}else{
			printf("Ainda não há produtos no Carrinho!");
		}
		system("pause");
        system("cls");				
	}

void fecharPedido(struct Produto produto[], struct Carrinho carrinho[], int qntProdCarrinho){
	int i = 0;
	float soma = 0;
	float valorTotal = 0;
	
		for(i = 0; i < qntProdCarrinho; i++){
			soma = (carrinho[i].produto.preco * carrinho[i].qntCarrinho);
			printf ("Produto: %s\n", carrinho[i].produto.nome);
			printf ("Unidades: %d\n", carrinho[i].qntCarrinho);
			printf ("Valor Unitário: %.2f\n", carrinho[i].produto.preco);
			printf("Valor Total do Produto: %.2f\n", soma);
			printf("--------------------\n\n");
			valorTotal += soma;
		}
		printf("Valor total do PEDIDO: %.2f\n", valorTotal);
		system("pause");
        system("cls");
        for(i = 0; i < qntProdCarrinho; i++){
        //	carrinho[i]->qntCarrinho = 0;
        //	strcpy(carrinho[i].produto->nome, "");
        //	carrinho[i].produto->preco = 0;
		//}
	}
}

void menuPrincipal(struct Produto produto[], struct Carrinho carrinho[], int *qnt, int qntProd, int *qntProdCarrinho){
	
	int op;
	int sair = 0;
	
	while(sair == 0){
	
		printf("-------------MENU-------------\n\n");
		printf("1. Cadastrar Produto\n2. Listar Produtos\n3. Comprar Produto\n4. Vizualizar Carrinho\n5. Fechar Pedido\n6. Sair\n");
		scanf(" %d", &op);
		
		system("cls");
		switch(op){
			case 1:
				cadastrarProduto(produto, qnt);
				break;
				
			case 2:
				listarProdutos(produto, *qnt);
				break;
			case 3:
				comprarProduto(produto, carrinho, qntProd, qntProdCarrinho, *qnt);
				break;
			case 4:
				vizualizarCarrinho(produto, carrinho, *qntProdCarrinho);
				break; 
			case 5:
				fecharPedido(produto, carrinho, *qntProdCarrinho);
				break;
			case 6:
				printf("Até a próxima!\n");
				sair++;
				break;
			default:
				printf("Opção inválida!\n");
				system("pause");
				system("cls");
				break;
		}
	}
}

int main(void){
	
	setlocale(LC_ALL, "Portuguese");

	struct Produto produto[50];
	struct Carrinho carrinho[50];
	int qnt = 0;
	int quantProd = 0;
	int qntCarrinho = 0;
	
	menuPrincipal(produto, carrinho, &qnt, quantProd, &qntCarrinho);
	
	

	return 0;
}
